{% load static %}
<div class="flex flex-col items-center justify-between h-screen w-full py-3 text-[10px] font-serif text-gray-500 rounded-lg">
   <div class="flex flex-col items-center w-full">
      <a href="{% url 'home' %}" class="flex justify-center w-full mb-5">
         <img src="{% static 'images/Vector SVG.svg' %}"
              alt="Vector LMD Logo"
              class="w-8 h-8">
      </a>
      <nav class="flex flex-col items-center w-full space-y-4">
         {% if user.is_authenticated %}
            <a href="{% url 'news:news_list' %}"
               class="flex flex-col items-center w-full sidebar-icon group"
               title="News">
               <svg xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25M16.5 7.5V18a2.25 2.25 0 0 0 2.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 0 0 2.25 2.25h13.5M6 7.5h3v3H6v-3Z" />
               </svg>
               <span class="sidebar-tooltip">News</span>
            </a>
            <a href="#"
               class="flex flex-col items-center w-full sidebar-icon group"
               title="Messages">
               <svg xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
               </svg>
               <span class="sidebar-tooltip">Messages</span>
            </a>
            <a href="{% url 'production:production_management' %}"
               class="flex flex-col items-center w-full sidebar-icon group"
               title="Production">
               <svg xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
               </svg>
               <span class="sidebar-tooltip">Production</span>
            </a>
            <a href="{% url 'metrics:index' %}"
               class="flex flex-col items-center w-full sidebar-icon group"
               title="Metrics">
               <svg xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" />
               </svg>
               <span class="sidebar-tooltip">Metrics</span>
            </a>
            <a href="{% url 'activities_dashboard' %}"
               class="flex flex-col items-center w-full sidebar-icon group"
               title="Activities">
               <svg xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
               </svg>
               <span class="sidebar-tooltip">Activities</span>
            </a>
         {% endif %}
         <a href="{% url 'about' %}"
            class="flex flex-col items-center w-full sidebar-icon group"
            title="About">
            <svg xmlns="http://www.w3.org/2000/svg"
                 class="w-5 h-5"
                 x="0px"
                 y="0px"
                 viewBox="0 0 50 50">
               <path d="M 25 2 C 12.309295 2 2 12.309295 2 25 C 2 37.690705 12.309295 48 25 48 C 37.690705 48 48 37.690705 48 25 C 48 12.309295 37.690705 2 25 2 z M 25 4 C 36.609824 4 46 13.390176 46 25 C 46 36.609824 36.609824 46 25 46 C 13.390176 46 4 36.609824 4 25 C 4 13.390176 13.390176 4 25 4 z M 25 11 A 3 3 0 0 0 22 14 A 3 3 0 0 0 25 17 A 3 3 0 0 0 28 14 A 3 3 0 0 0 25 11 z M 21 21 L 21 23 L 22 23 L 23 23 L 23 36 L 22 36 L 21 36 L 21 38 L 22 38 L 23 38 L 27 38 L 28 38 L 29 38 L 29 36 L 28 36 L 27 36 L 27 21 L 26 21 L 22 21 L 21 21 z">
               </path>
            </svg>
            <span class="sidebar-tooltip">About</span>
         </a>
         <a href="{% url 'contact' %}"
            class="flex flex-col items-center w-full sidebar-icon group"
            title="Contact">
            <svg xmlns="http://www.w3.org/2000/svg"
                 class="w-5 h-5"
                 fill="none"
                 viewBox="0 0 24 24"
                 stroke="currentColor">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            <span class="sidebar-tooltip">Contact</span>
         </a>
      </div>
      <!-- User section at bottom -->
      <div class="flex justify-center w-full pt-4 mt-auto mb-4 border-t border-gray-200">
         {% if user.is_authenticated %}
            <div class="relative"
                 x-data="{ open: false, top: 0, left: 0 }"
                 @click="top = $event.clientY - 200; left = $event.clientX + 20;">
               <button @click="open = !open"
                       class="flex flex-col sidebar-icon group"
                       title="{{ user.username }}">
                  {% if user.authenticate_profile.avatar and user.authenticate_profile.avatar.url %}
                     <div class="relative">
                        <!-- Try loading the user avatar with error handling -->
                        <img src="{{ user.authenticate_profile.avatar.url }}"
                             alt="{{ user.username }}"
                             class="object-cover w-12 h-12 transition-all border-2 border-gray-200 rounded-full shadow-md hover:border-blue-400"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <!-- Fallback that will be shown if the image fails to load -->
                        <div style="display:none"
                             class="flex items-center justify-center w-12 h-12 text-white bg-blue-500 border-2 border-gray-200 rounded-full shadow-md hover:border-blue-400">
                           <span class="text-sm font-medium">{{ user.username|slice:":2"|upper }}</span>
                        </div>
                     </div>
                  {% else %}
                     <div class="flex items-center justify-center w-12 h-12 text-white bg-blue-500 border-2 border-gray-200 rounded-full shadow-md hover:border-blue-400">
                        <span class="text-sm font-medium">{{ user.username|slice:":2"|upper }}</span>
                     </div>
                  {% endif %}
                  <span class="sidebar-tooltip">{{ user }}</span>
               </button>
               <!-- Dropdown Menu - Fixed positioning with dynamic coordinates -->
               <div x-show="open"
                    x-cloak
                    @keydown.escape.window="open = false"
                    @click.away="open = false"
                    style="display: none"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="transform opacity-0 scale-95"
                    x-transition:enter-end="transform opacity-100 scale-100"
                    x-transition:leave="transition ease-in duration-75"
                    x-transition:leave-start="transform opacity-100 scale-100"
                    x-transition:leave-end="transform opacity-0 scale-95"
                    :style="`position: fixed; top: ${top}px; left: ${left}px;`"
                    class="z-[9999] w-64 py-2 bg-white border border-gray-200 rounded-lg shadow-2xl backdrop-blur-sm bg-white/90">
                  <div class="px-4 py-3 border-b border-gray-100">
                     <p class="text-xs font-medium text-gray-400 uppercase">Account</p>
                     <p class="text-sm font-medium text-gray-700">{{ user.username }}</p>
                  </div>
                  <div class="py-1">
                     <a href="{% url 'profile' %}"
                        class="flex items-center px-4 py-2 text-sm text-gray-700 transition-colors hover:bg-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke-width="1.5"
                             stroke="currentColor"
                             class="w-4 h-4 mr-3 text-gray-500">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                        My Profile
                     </a>
                     <a href="{% url 'password_change' %}"
                        class="flex items-center px-4 py-2 text-sm text-gray-700 transition-colors hover:bg-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke-width="1.5"
                             stroke="currentColor"
                             class="w-4 h-4 mr-3 text-gray-500">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                        </svg>
                        Change Password
                     </a>
                     {% if user.is_staff %}
                        <a href="{% url 'admin:index' %}"
                           class="flex items-center px-4 py-2 text-sm text-gray-700 transition-colors hover:bg-gray-100">
                           <svg xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                                stroke="currentColor"
                                class="w-4 h-4 mr-3 text-gray-500">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z" />
                           </svg>
                           Admin Panel
                        </a>
                     {% endif %}
                  </div>
                  <div class="border-t border-gray-100"></div>
                  <div class="py-1">
                     <a href="{% url 'logout' %}"
                        class="flex items-center px-4 py-2 text-sm text-red-600 transition-colors hover:bg-red-50">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke-width="1.5"
                             stroke="currentColor"
                             class="w-4 h-4 mr-3 text-red-500">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                        </svg>
                        Logout
                     </a>
                  </div>
               </div>
            </div>
         {% else %}
            <div class="flex flex-col items-center space-y-4">
               <a href="{% url 'login' %}"
                  class="flex flex-col items-center w-full text-[10px] text-gray-500 sidebar-icon group"
                  title="Login">
                  <svg xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24"
                       stroke-width="1.5"
                       stroke="currentColor"
                       class="w-6 h-6">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z" />
                  </svg>
                  <span class="sidebar-tooltip">Login</span>
               </a>
               <a href="{% url 'register' %}"
                  class="flex flex-col items-center w-full sidebar-icon group text-[10px] tex=gray-500"
                  title="Register">
                  <svg xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24"
                       stroke-width="1.5"
                       stroke="currentColor"
                       class="w-6 h-6">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" />
                  </svg>
                  <span class="sidebar-tooltip">Register</span>
               </a>
            </div>
         {% endif %}
      </div>
   </div>
